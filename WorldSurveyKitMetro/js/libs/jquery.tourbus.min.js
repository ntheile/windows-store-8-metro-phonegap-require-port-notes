(function(){var n=[].slice;(function(t){var f,e,o,u,h,c,l,r,i,s,a;return u=t.tourbus=function(){var i,r;return i=1<=arguments.length?n.call(arguments,0):[],r=i[0],o.hasOwnProperty(r)?i=i.slice(1):r instanceof t?r="build":typeof r=="string"?(r="build",i[0]=t(i[0])):t.error("Unknown method of $.tourbus --",i),o[r].apply(this,i)},t.fn.tourbus=function(){var i;return i=1<=arguments.length?n.call(arguments,0):[],this.each(function(){return i.unshift(t(this)),u.apply(null,["build"].concat(n.call(i))),this})},o={build:function(n,i){var r;return(i==null&&(i={}),i=t.extend(!0,{},u.defaults,i),r=[],n instanceof t||(n=t(n)),n.each(function(){return r.push(l(this,i))}),r.length===0&&t.error(""+n.selector+" was not found!"),r.length===1)?r[0]:r},destroyAll:function(){var n,t,i=[];for(t in r)n=r[t],i.push(n.destroy());return i},expose:function(n){return n.tourbus={Bus:f,Leg:e}}},u.defaults={debug:!1,autoDepart:!1,target:"body",startAt:0,onDepart:function(){return null},onStop:function(){return null},onLegStart:function(){return null},onLegEnd:function(){return null},leg:{scrollTo:null,scrollSpeed:150,scrollContext:100,orientation:"bottom",align:"left",width:"auto",margin:10,top:null,left:null,arrow:"50%"}},f=function(){function i(n,i){this.id=h();this.$target=t(i.target);this.$el=t(n);this.$el.data({tourbus:this});this.options=i;this.currentLegIndex=null;this.legs=null;this.legEls=this.$el.children("li");this.totalLegs=this.legEls.length;this._setupEvents();this.options.autoDepart&&this.$el.trigger("depart.tourbus");this._log("built tourbus with el",n.toString(),"and options",this.options)}return i.prototype.depart=function(){this.running=!0;this.options.onDepart(this);return this._log("departing",this),this.legs=this._buildLegs(),this.currentLegIndex=this.options.startAt,this.showLeg()},i.prototype.stop=function(){if(this.running){this.legs&&t.each(this.legs,t.proxy(this.hideLeg,this));this.currentLegIndex=this.options.startAt;this.options.onStop(this);return this.running=!1}},i.prototype.on=function(n,t,i){return this.$target.on(n,t,i)},i.prototype.currentLeg=function(){return this.currentLegIndex===null?null:this.legs[this.currentLegIndex]},i.prototype.showLeg=function(n){var t,i;return n==null&&(n=this.currentLegIndex),t=this.legs[n],this._log("showLeg:",t),i=this.options.onLegStart(t,this),i!==!1?t.show():void 0},i.prototype.hideLeg=function(n){var t,i;return n==null&&(n=this.currentLegIndex),t=this.legs[n],this._log("hideLeg:",t),i=this.options.onLegEnd(t,this),i!==!1?t.hide():void 0},i.prototype.repositionLegs=function(){if(this.legs)return t.each(this.legs,function(){return this.reposition()})},i.prototype.next=function(){return(this.hideLeg(),this.currentLegIndex++,this.currentLegIndex>this.totalLegs-1)?this.stop():this.showLeg()},i.prototype.prev=function(){return(this.hideLeg(),this.currentLegIndex--,this.currentLegIndex<0)?this.stop():this.showLeg()},i.prototype.destroy=function(){return this.legs&&t.each(this.legs,function(){return this.destroy()}),this.legs=null,delete r[this.id],this._teardownEvents()},i.prototype._buildLegs=function(){var n=this;return this.legs&&t.each(this.legs,function(n,t){return t.destroy()}),t.map(this.legEls,function(i,r){var f,o,u;f=t(i);o=f.data();u=new e({content:f.html(),target:o.el||"body",bus:n,index:r,rawData:o});u.render();try{n.$target.append(u.$el)}catch(s){MSApp.execUnsafeLocalFunction(function(){n.$target.append(u.$el)})}return u._position(),u.hide(),u})},i.prototype._log=function(){if(this.options.debug)return console.log.apply(console,["TOURBUS "+this.id+":"].concat(n.call(arguments)))},i.prototype._setupEvents=function(){this.$el.on("depart.tourbus",t.proxy(this.depart,this));this.$el.on("stop.tourbus",t.proxy(this.stop,this));this.$el.on("next.tourbus",t.proxy(this.next,this));return this.$el.on("prev.tourbus",t.proxy(this.prev,this))},i.prototype._teardownEvents=function(){return this.$el.off(".tourbus")},i}(),e=function(){function n(n){if(this.bus=n.bus,this.rawData=n.rawData,this.content=n.content,this.index=n.index,this.options=n,this.$target=t(n.target),this.$target.length===0)throw""+this.$target.selector+" is not an element!";this._setupOptions();this._configureElement();this._configureTarget();this._configureScroll();this._setupEvents();this.bus._log("leg "+this.index+" made with options",this.options)}return n.prototype.render=function(){var n,t;return n=this.options.orientation==="centered"?"":"tourbus-arrow",this.$el.addClass(" "+n+" tourbus-arrow-"+this.options.orientation+" "),t="<div class='tourbus-leg-inner'>\n  "+this.content+"\n<\/div>",this.$el.css({width:this.options.width}).html(t),this},n.prototype.destroy=function(){return this.$el.remove(),this._teardownEvents()},n.prototype.reposition=function(){return this._configureTarget(),this._position()},n.prototype._position=function(){var t,r,n,i;return this.options.orientation!=="centered"&&(n={},r={top:"left",bottom:"left",left:"top",right:"top"},typeof this.options.arrow=="number"&&(this.options.arrow+="px"),n[r[this.options.orientation]]=this.options.arrow,i="#"+this.id+".tourbus-arrow",this.bus._log("adding rule for "+this.id,n),c(""+i+":before, "+i+":after",n)),t=this._offsets(),this.bus._log("setting offsets on leg",t),this.$el.css(t)},n.prototype.show=function(){return this.$el.css({visibility:"visible",opacity:1,zIndex:9999}),this.scrollIntoView()},n.prototype.hide=function(){return this.bus.options.debug?this.$el.css({visibility:"visible",opacity:.4,zIndex:0}):this.$el.css({visibility:"hidden"})},n.prototype.scrollIntoView=function(){var n;if(this.willScroll)return n=i(this.options.scrollTo,this.$el),this.bus._log("scrolling to",n,this.scrollSettings),t.scrollTo(n,this.scrollSettings)},n.prototype._setupOptions=function(){var n;return n=this.bus.options.leg,this.options.top=i(this.rawData.top,n.top),this.options.left=i(this.rawData.left,n.left),this.options.scrollTo=i(this.rawData.scrollTo,n.scrollTo),this.options.scrollSpeed=i(this.rawData.scrollSpeed,n.scrollSpeed),this.options.scrollContext=i(this.rawData.scrollContext,n.scrollContext),this.options.margin=i(this.rawData.margin,n.margin),this.options.arrow=this.rawData.arrow||n.arrow,this.options.align=this.rawData.align||n.align,this.options.width=this.rawData.width||n.width,this.options.orientation=this.rawData.orientation||n.orientation},n.prototype._configureElement=function(){return this.id="tourbus-leg-id-"+this.bus.id+"-"+this.options.index,this.$el=t("<div class='tourbus-leg'><\/div>"),this.el=this.$el[0],this.$el.attr({id:this.id}),this.$el.css({zIndex:9999})},n.prototype._setupEvents=function(){this.$el.on("click",".tourbus-next",t.proxy(this.bus.next,this.bus));this.$el.on("click",".tourbus-prev",t.proxy(this.bus.prev,this.bus));return this.$el.on("click",".tourbus-stop",t.proxy(this.bus.stop,this.bus))},n.prototype._teardownEvents=function(){return this.$el.off("click")},n.prototype._configureTarget=function(){return this.targetOffset=this.$target.offset(),i(this.options.top,!1)&&(this.targetOffset.top=this.options.top),i(this.options.left,!1)&&(this.targetOffset.left=this.options.left),this.targetWidth=this.$target.outerWidth(),this.targetHeight=this.$target.outerHeight()},n.prototype._configureScroll=function(){return this.willScroll=t.fn.scrollTo&&this.options.scrollTo!==!1,this.scrollSettings={offset:-this.options.scrollContext,easing:"linear",axis:"y",duration:this.options.scrollSpeed}},n.prototype._offsets=function(){var o,r,u,f,n,e,c,h;u=this.$el.height();f=this.$el.width();n={};switch(this.options.orientation){case"centered":c=t(window).height();n.top=this.options.top;i(n.top,!1)||(n.top=c/2-u/2);n.left=this.targetWidth/2-f/2;break;case"left":n.top=this.targetOffset.top;n.left=this.targetOffset.left-f-this.options.margin;break;case"right":n.top=this.targetOffset.top;n.left=this.targetOffset.left+this.targetWidth+this.options.margin;break;case"top":n.top=this.targetOffset.top-u-this.options.margin;n.left=this.targetOffset.left;break;case"bottom":n.top=this.targetOffset.top+this.targetHeight+this.options.margin;n.left=this.targetOffset.left}if(h={top:["left","right"],bottom:["left","right"],left:["top","bottom"],right:["top","bottom"]},s(this.options.orientation,h[this.options.align]))switch(this.options.align){case"right":n.left+=this.targetWidth-f;break;case"bottom":n.top+=this.targetHeight-u}else this.options.align==="center"&&(s(this.options.orientation,h.left)?(e=this.targetWidth/2,r=f/2,o="left"):(e=this.targetHeight/2,r=u/2,o="top"),e>r?n[o]+=e-r:n[o]-=r-e);return n},n}(),a=0,h=function(){return a++},r={},l=function(){var n;return n=function(n,t,i){i.prototype=n.prototype;var u=new i,r=n.apply(u,t);return Object(r)===r?r:u}(f,arguments,function(){}),r[n.id]=n,n},i=function(n,t){return n===null||typeof n=="undefined"?t:n},s=function(n,i){return t.inArray(n,i||[])!==-1},c=function(n){var i;return n.type="text/css",document.getElementsByTagName("head")[0].appendChild(n),i=document.styleSheets[document.styleSheets.length-1],function(n,r){var u,f=t.map(function(){var n=[];for(u in r)n.push(u);return n}(),function(n){return""+n+":"+r[n]}).join(";");try{i.insertRule?i.insertRule(""+n+" { "+f+" }",(i.cssRules||i.rules).length):i.addRule(n,f)}catch(e){}}}(document.createElement("style"))})(jQuery)}).call(this);
//# sourceMappingURL=jquery.tourbus.min.js.map
